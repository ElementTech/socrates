

<form cdkDropListGroup class="d-flex" [formGroup]="flowForm" (ngSubmit)="onSubmit()">

    
    <div class="example-container">
      <mat-toolbar class="d-flex justify-content-center">
        <i class="fa-solid fa-cubes" aria-hidden="true"></i> <h1 style="margin-right: 1em;">&nbsp;Instances</h1>
    </mat-toolbar>
  

    
      <div
        infinite-scroll
        [infiniteScrollDistance]="scrollDistance"
        [scrollWindow]="false"
        [horizontal]="false"
        [infiniteScrollUpDistance]="scrollUpDistance"
        [infiniteScrollThrottle]="throttle"
        (scrolled)="onScrollDown($event)"
        (scrolledUp)="onUp($event)"
        cdkDropList
        [cdkDropListData]="array"
        class="example-list infinite"
        id="initial-list"
       
        (cdkDropListDropped)="drop($event)">
        <div class="example-box" *ngFor="let i of array" cdkDrag>
         
          <img width="50px" [src]="this.imageUrls[i.image]">
          {{i.name}}
          <mat-chip-list>
            <ng-container aria-label="Parameters" *ngIf='i.parameters.length != 0'>
           
              <mat-chip style="font-size:smaller" color="primary" selected *ngFor="let param of i.parameters">
     
                  {{param.key}}
              </mat-chip>
           
            </ng-container>
            <ng-container aria-label="Parameters" *ngIf='i.shared.length != 0'>
             
              <mat-chip style="font-size:smaller" color="accent" selected *ngFor="let param of i.shared">
                {{param.key}}
              </mat-chip>
           
            </ng-container>
          </mat-chip-list>

        </div>
      </div>
    </div>
  
    <div class="chart-container" style="min-width: 60%;">
        <ngx-graph
          [links]="links"
          [nodes]="nodes"
          [layout]="layout"
          [curve]="curve"
          [enableZoom]="true"
          [draggingEnabled]="false"
        >
          <ng-template #defsTemplate>
              <svg:marker id="arrow" viewBox="0 -5 10 10" refX="8" refY="0" markerWidth="4" markerHeight="4" orient="auto">
              <svg:path d="M0,-5L10,0L0,5" class="arrow-head" />
              </svg:marker>
          </ng-template>
      
          <ng-template #clusterTemplate let-cluster>
              <svg:g class="node cluster">
              <svg:rect
                  rx="5"
                  ry="5"
                  [attr.width]="cluster.dimension.width"
                  [attr.height]="cluster.dimension.height"
                  [attr.fill]="cluster.data.color"
              />
              </svg:g>
          </ng-template>
      
          <ng-template #nodeTemplate let-node>
              <svg:g *ngIf="node.label != '+'"
              (click)="onNodeClick($event)"
              (dblclick)="onNodeDblClick($event)"
              class="node"
              ngx-tooltip
              [tooltipPlacement]="'top'"
              [tooltipType]="'tooltip'"
              [tooltipTitle]="node.label"
              >
              <svg:rect
                  [attr.width]="node.dimension.width"
                  [attr.height]="node.dimension.height"
                  [attr.fill]="node.data.color"
              />
              <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">
                  {{node.label}}
              </svg:text>
              </svg:g>
              <svg:g *ngIf="node.label == '+'"
              (click)="onPlusClick(node)"
             
              class="plus"
              ngx-tooltip
              [tooltipPlacement]="'top'"
              [tooltipType]="'tooltip'"
              [tooltipTitle]="node.label"
              >
              <svg:rect class="rect"
                  [attr.width]="node.dimension.width"
                  [attr.height]="node.dimension.height"
                  [attr.fill]="node.data.color"
                  
              />
              <svg:text class="text" alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">
                  {{node.label}}
              </svg:text>
              </svg:g>
          </ng-template>
      
          <ng-template #linkTemplate let-link>
              <svg:g class="edge">
              <svg:path class="line" stroke-width="2" marker-end="url(#arrow)"></svg:path>
              <svg:text class="edge-label" text-anchor="middle">
                  <textPath
                  class="text-path"
                  [attr.href]="'#' + link.id"
                  [style.dominant-baseline]="link.dominantBaseline"
                  startOffset="50%"
                  >
                  <!-- {{link.label}} -->
                  </textPath>
              </svg:text>
              </svg:g>
          </ng-template>
      
        </ngx-graph>
      </div>
      
    <div class="details text-center">
     
      <mat-toolbar class="d-flex justify-content-center">
        <i class="fa-solid fa-info-circle" aria-hidden="true"></i> <h1 style="margin-right: 1em;">&nbsp;Details</h1>
        <button mat-raised-button color="primary" type="submit" *ngIf="this.id == ''">Create</button>
        <button mat-raised-button color="primary" type="submit" *ngIf="this.id != ''">Update</button>
      </mat-toolbar>
    
      <mat-form-field class="w-100 pt-3" appearance="fill">
        <mat-label>Name</mat-label>
        <input matInput placeholder="My Flow" formControlName="name" required>
      </mat-form-field>
      <mat-form-field class="w-100" appearance="fill">
        <mat-label>Icon</mat-label>
        <mat-select formControlName="image">
          <mat-option [value]="image.name" *ngFor="let image of Images | async">
            <img width="30px" [src]="this.imageUrls[image.name]"> {{image.name}}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix ><img width="30px" style="margin-bottom:25px;" [src]="this.imageUrls[this.flowForm.get('image').value]"></mat-icon>
      </mat-form-field> 
      <mat-form-field class="w-100" appearance="fill">
        <mat-label>Description</mat-label>
        <textarea class="desc" matInput placeholder="Description" formControlName="desc"></textarea>
      </mat-form-field>
   
    </div>
  </form>